---
title: 'docker部署'
sidebar_position: 3

---
## 环境准备 🌍

- 在服务器上安装带有 Compose 插件的 Docker 或 docker-compose。安装详情请访问 [Docker Compose 安装指南](https://docs.docker.com/compose/install/linux/)。

## 仓库克隆 🗂️

```bash
git clone https://github.com/openimsdk/openim-docker
```

## 配置修改 🔧

- 修改 `.env` 文件，配置外网 IP。如果使用域名，需配置 [Nginx](./nginxDomainConfig.mdx)

  ```plaintext
  # 设置 MinIO 服务的外网访问地址（外网IP或域名）
  MINIO_EXTERNAL_ADDRESS="http://external_ip:10005"
  ```

  >注意：docker部署不采用配置挂载的模式，在config目录下面修改配置文件无效！请采用环境变量的方式修改配置。
  >
  >配置格式说明：docker方式部署如果需要修改配置，则需要通过修改docker-compose.yaml中的环境变量来实现。例如修改`openim-server`的配置文件`openim-api.yml`中的`prometheus.grafanaURL`字段，则应在`docker-compose.yaml`文件中的`openim-server`的`environment`下添加：`- IMENV_OPENIM_API_PROMETHEUS_GRAFANAURL=${GRAFANA_URL}`。`IMENV`为`openim-server`配置的固定前缀，文件名和字段之间的分隔符全部为`_`，并且全部改为大写。

- 其他配置请参考 .env 中的注释

## 服务启动 🚀

- 启动服务：

```bash
docker compose up -d
```

- 启动服务+监控组件（可选）：

```bash
docker compose --profile m up -d
```

- 停止服务：

```bash
docker compose down
```

- 查看日志：

```bash
docker logs -f openim-server
docker logs -f openim-chat
```

## 快速体验 ⚡

快速体验 OpenIM 服务，请参考[快速验证](./quickTestServer)。

---

## ❓ 常见问题

### 1.能正常发送文本消息，但发送图片失败 😕

可能是因为没有在执行 `docker compose up -d` 命令之前设置 `OPENIM_IP` 环境变量。可以通过查看启动时日志，或使用以下命令搜索日志中的 "127.0.0.1" 地址来确认：

```bash
grep "127.0.0.1" openim-server/_output/logs/openim-docker.log
```

#### 解决方案：

1. 设置 `OPENIM_IP` 环境变量为你的公网IP地址，如仅提供内网服务则为内网IP地址：

   ```bash
   export OPENIM_IP="<Public-IP>"
   ```

2. 使用 `sed` 命令更新 `config.yaml` 文件中的 `apiURL` 和 `signEndpoint` 配置项，将地址改为使用 `OPENIM_IP` 环境变量指定的IP地址：

   ```bash
   sed -i -e "s/apiURL: \"http:\/\/127\.0\.0\.1/apiURL: \"http:\/\/${OPENIM_IP}/" \
          -e "s/signEndpoint: \"http:\/\/127\.0\.0\.1/signEndpoint: \"http:\/\/${OPENIM_IP}/" \
          openim-server/config/config.yaml
   ```

通过上述步骤修改配置并重启服务后，应能正常发送图片消息。

### 6.2 关于 Docker 版本 🐋
强烈要求使用 docker compose 命令而不是 docker-compose，老版本 Docker 可能不支持 gateway 功能❌。我们建议您升级到较新的版本，例如 `23.0.1`🔝


### 6.3 日志查看 📜

日志位置：

- `{openim-server, openim-chat}/_output/logs/openim-service-log.*`

